{"ast":null,"code":"export const baseApiUrl = \"https://api.spotify.com\";\nexport const tokenUrl = \"https://accounts.spotify.com/api/token\";\nexport const clientId = \"a23843d079a34f28a8368672dc8a7bcd\";\nexport const clientSecret = \"d98f121afd3b4d9babc64ce90f4d35f2\";\nexport const redirectUri = 'http://localhost:3000';\nexport async function getAccessToken() {\n  let authCode, codeVerifier;\n  let i = 0;\n  while (i++ < 10) {\n    authCode = getAuthCode();\n    codeVerifier = localStorage.getItem('code_verifier');\n    if (!authCode) {\n      authorize();\n      continue;\n    }\n    let body = new URLSearchParams({\n      grant_type: 'authorization_code',\n      code: authCode,\n      redirect_uri: redirectUri,\n      client_id: clientId,\n      code_verifier: codeVerifier\n    });\n    const response = await fetch(tokenUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      },\n      body: body\n    });\n    if (!response.ok) {\n      switch (response.status) {\n        case 400:\n          authorize();\n      }\n      continue;\n    }\n    let data = await response.json();\n    localStorage.setItem('accessToken', data.access_token);\n    break;\n  }\n}\nexport function generateRandomString(length) {\n  let text = '';\n  let possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  for (let i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n  return text;\n}\nexport async function generateCodeChallenge(codeVerifier) {\n  function base64encode(string) {\n    return btoa(String.fromCharCode.apply(null, new Uint8Array(string))).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n  }\n  const encoder = new TextEncoder();\n  const data = encoder.encode(codeVerifier);\n  const digest = await window.crypto.subtle.digest('SHA-256', data);\n  return base64encode(digest);\n}\nexport async function authorize() {\n  let codeVerifier = generateRandomString(128);\n  generateCodeChallenge(codeVerifier).then(codeChallenge => {\n    let state = generateRandomString(16);\n    let scope = 'user-read-private user-read-email playlist-modify-private playlist-modify-public';\n    localStorage.setItem('code_verifier', codeVerifier);\n    let args = new URLSearchParams({\n      response_type: 'code',\n      client_id: clientId,\n      scope: scope,\n      redirect_uri: redirectUri,\n      state: state,\n      code_challenge_method: 'S256',\n      code_challenge: codeChallenge\n    });\n    window.location = 'https://accounts.spotify.com/authorize?' + args;\n  });\n}\nexport function getAuthCode() {\n  const urlParams = new URLSearchParams(window.location.search);\n  if (urlParams.has('code')) return urlParams.get('code');else return \"\";\n}\nexport function isLoggedIn() {\n  return true;\n}","map":{"version":3,"names":["baseApiUrl","tokenUrl","clientId","clientSecret","redirectUri","getAccessToken","authCode","codeVerifier","i","getAuthCode","localStorage","getItem","authorize","body","URLSearchParams","grant_type","code","redirect_uri","client_id","code_verifier","response","fetch","method","headers","ok","status","data","json","setItem","access_token","generateRandomString","length","text","possible","charAt","Math","floor","random","generateCodeChallenge","base64encode","string","btoa","String","fromCharCode","apply","Uint8Array","replace","encoder","TextEncoder","encode","digest","window","crypto","subtle","then","codeChallenge","state","scope","args","response_type","code_challenge_method","code_challenge","location","urlParams","search","has","get","isLoggedIn"],"sources":["/home/linkachu/jammming/src/AuthActions.js"],"sourcesContent":["export const baseApiUrl = \"https://api.spotify.com\";\nexport const tokenUrl = \"https://accounts.spotify.com/api/token\";\nexport const clientId = \"a23843d079a34f28a8368672dc8a7bcd\";\nexport const clientSecret = \"d98f121afd3b4d9babc64ce90f4d35f2\";\nexport const redirectUri = 'http://localhost:3000';\n\nexport async function getAccessToken(){\n    let authCode, codeVerifier;\n    \n    let i = 0\n    while(i++ < 10){   \n        authCode = getAuthCode();\n        codeVerifier = localStorage.getItem('code_verifier');\n        \n        if(!authCode){\n            authorize();\n            continue;\n        }\n\n        let body = new URLSearchParams({\n            grant_type: 'authorization_code',\n            code: authCode,\n            redirect_uri: redirectUri,\n            client_id: clientId,\n            code_verifier: codeVerifier\n        });\n        \n        const response = await fetch(tokenUrl, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: body\n        })\n\n        if (!response.ok){\n            switch(response.status){\n                case 400:\n                    authorize();\n            }\n            continue;\n        }    \n        \n        let data = await response.json();\n        localStorage.setItem('accessToken', data.access_token);\n        \n        break;\n    }\n}\n\nexport function generateRandomString(length) {\n    let text = '';\n    let possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  \n    for (let i = 0; i < length; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n}\n\nexport async function generateCodeChallenge(codeVerifier) {\n    function base64encode(string) {\n      return btoa(String.fromCharCode.apply(null, new Uint8Array(string)))\n        .replace(/\\+/g, '-')\n        .replace(/\\//g, '_')\n        .replace(/=+$/, '');\n    }\n  \n    const encoder = new TextEncoder();\n    const data = encoder.encode(codeVerifier);\n    const digest = await window.crypto.subtle.digest('SHA-256', data);\n  \n    return base64encode(digest);\n}\n\nexport async function authorize(){\n    let codeVerifier = generateRandomString(128);\n    \n    generateCodeChallenge(codeVerifier).then(codeChallenge => {\n        let state = generateRandomString(16);\n        let scope = 'user-read-private user-read-email playlist-modify-private playlist-modify-public';\n\n        localStorage.setItem('code_verifier', codeVerifier);\n\n        let args = new URLSearchParams({\n            response_type: 'code',\n            client_id: clientId,\n            scope: scope,\n            redirect_uri: redirectUri,\n            state: state,\n            code_challenge_method: 'S256',\n            code_challenge: codeChallenge\n        });\n\n        window.location = 'https://accounts.spotify.com/authorize?' + args;\n    });\n}\n\nexport function getAuthCode(){\n    const urlParams = new URLSearchParams(window.location.search);\n\n    if (urlParams.has('code'))\n        return urlParams.get('code')\n    else\n        return \"\";\n}\n\nexport function isLoggedIn(){\n    return true;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}